# Интерактивная кнопка "Наверх" с эффектом "убегания"

## Описание функции

Кнопка "Прокрутить наверх" на странице детального просмотра блога (`/blog/[slug]`) теперь обладает игривым интерактивным поведением - она "убегает" от курсора мыши при приближении.

## Как это работает

### Основная механика

1. **Отслеживание положения курсора**: Компонент использует глобальный обработчик события `mousemove` для отслеживания позиции курсора в реальном времени.

2. **Вычисление расстояния**: Каждый раз при движении мыши рассчитывается расстояние от курсора до центра кнопки по формуле:
   ```javascript
   distance = √((mouseX - buttonX)² + (mouseY - buttonY)²)
   ```

3. **Триггер "убегания"**: Когда курсор приближается ближе чем на **100 пикселей** к кнопке, активируется таймер задержки на **200 миллисекунд**, после чего кнопка начинает "убегать".

4. **Задержка реакции**: Добавлена задержка в 200мс перед убеганием, что дает "быстрым рукам" шанс поймать кнопку до того, как она начнет движение.

5. **Направление движения**: Кнопка движется в направлении, **противоположном** от курсора:
   - Вычисляется угол между курсором и кнопкой
   - Кнопка смещается на **80 пикселей** в противоположную сторону

6. **Возврат на место**: Когда курсор отдаляется дальше чем на **200 пикселей** (100 + 100), кнопка плавно возвращается в исходное положение.

### Технические детали

**Файл**: `src/app/blog/[slug]/page.tsx`

**Состояния компонента**:
- `buttonRight` - смещение по горизонтали (от -200px до +200px)
- `buttonBottom` - позиция от нижнего края (учитывает футер)
- `isRunningAway` - флаг, указывающий на активное "убегание"
- `buttonRef` - ссылка на DOM-элемент кнопки
- `escapeTimeoutRef` - ref для управления таймером задержки убегания

**Ключевые параметры**:
```javascript
triggerDistance = 100  // Радиус срабатывания (px)
escapeDistance = 80    // Дистанция убегания (px)
escapeDelay = 200      // Задержка перед убеганием (ms)
maxRight = 200         // Максимальное смещение вправо/влево (px)
maxBottom = вычисляется // Ограничено положением футера
```

**Анимация**:
- При убегании: `cubic-bezier(0.34, 1.56, 0.64, 1)` - плавное движение с пружинящим эффектом (0.25s)
- При возврате: `cubic-bezier(0.4, 0, 0.2, 1)` - плавный возврат (0.6s)
- Оптимизация: `willChange: 'bottom, right'` для улучшенной производительности

**Ограничения**:
- ✅ Кнопка **не заходит за футер** - футер служит нижней границей
- ✅ Ограничение по горизонтали: ±200px от исходной позиции
- ✅ При возврате кнопка учитывает положение футера
- ✅ Таймер убегания корректно очищается при отмене или размонтировании компонента

## Пользовательский опыт

### Позитивные эффекты
- ✅ **Игривость**: Добавляет элемент веселья и неожиданности
- ✅ **Запоминаемость**: Пользователи запомнят этот уникальный интерфейс
- ✅ **Микроинтеракция**: Создает эмоциональную связь с интерфейсом
- ✅ **Все еще доступна**: Кнопку можно кликнуть, подойдя медленно или быстрым движением
- ✅ **Баланс между игривостью и доступностью**: Задержка в 200мс дает шанс "быстрым рукам" успеть кликнуть до убегания

### Важные замечания
- Кнопка остается функциональной - при клике всегда прокручивает наверх
- Ограничения движения не дают кнопке уйти за пределы видимости
- Плавные анимации делают взаимодействие приятным
- Совместима с адаптацией к футеру
- Таймер автоматически отменяется, если курсор быстро движется или компонент размонтируется
- Оптимизирована производительность: обработчик `mousemove` активируется только когда кнопка видима

## Настройка поведения

Для изменения поведения отредактируйте следующие константы в `ScrollToTopButton`:

```javascript
// Радиус реагирования на курсор
const triggerDistance = 100  // увеличьте для более чувствительной кнопки

// Дистанция убегания
const escapeDistance = 80    // увеличьте, чтобы кнопка убегала дальше

// Задержка перед убеганием
const escapeDelay = 200      // увеличьте для более легкого "поимки"

// Ограничения движения
const maxRight = 200         // макс. смещение влево/вправо
const maxBottomOffset = 150  // макс. смещение вверх/вниз
```

## Отключение функции

Чтобы вернуть стандартное поведение кнопки:

1. Удалите состояния `buttonRight` и `isRunningAway`
2. Удалите второй `useEffect` с обработчиком `mousemove`
3. Удалите `buttonRef` и `escapeTimeoutRef`
4. Верните фиксированное значение `right` в стилях кнопки (например, `right: 'calc(50% - 640px + 2rem)'`)

## Браузерная совместимость

- ✅ Chrome/Edge (все версии)
- ✅ Firefox (все версии)
- ✅ Safari (все версии)
- ✅ Мобильные браузеры (функция не активна на тач-устройствах)

## История изменений

**2025-12-09 (v3)**: Финальная настройка параметров для баланса игривости и доступности
- Уменьшен радиус срабатывания до 100px (был 150px)
- Уменьшена дистанция убегания до 80px (была 120px)
- Добавлена задержка 200мс перед убеганием для "быстрых рук"
- Уменьшен максимальный горизонтальный сдвиг до 200px (был 250px)
- Добавлено управление таймером через `escapeTimeoutRef`
- Улучшена очистка таймеров при размонтировании

**2025-12-09 (v2)**: Улучшение плавности движения и интеграция с футером
- Добавлена проверка границ футера для предотвращения наложения
- Улучшены анимации с использованием cubic-bezier кривых
- Добавлена оптимизация `willChange` для производительности

**2025-12-09 (v1)**: Добавлена базовая функция "убегания от курсора"
- Реализовано отслеживание позиции мыши
- Добавлена логика вычисления расстояния и направления
- Настроены плавные анимации
- Добавлены ограничения движения

---

**Статус**: ✅ Реализовано и протестировано
**Автор**: Claude Code
**Дата**: 9 декабря 2025
