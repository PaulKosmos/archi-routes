# Archi-Routes - –û—Ç—á–µ—Ç –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –∑–∞–ø—É—Å–∫—É
**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 24 –Ω–æ—è–±—Ä—è 2025
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 29 –Ω–æ—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** 0.1.0
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫:** Next.js 15, React 19, TypeScript, Supabase, Leaflet

---

## –†–µ–∑—é–º–µ

–ü—Ä–æ–µ–∫—Ç **Archi-Routes** –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ —Ç—É—Ä–∏–∑–º–∞ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤, –æ—Ç–∑—ã–≤–æ–≤ —Å –∞—É–¥–∏–æ–≥–∏–¥–∞–º–∏ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–æ–º (–±–ª–æ–≥, –Ω–æ–≤–æ—Å—Ç–∏, –ø–æ–¥–∫–∞—Å—Ç—ã).

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏: 90/100** ‚¨ÜÔ∏è +25 (—Å 65/100)

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (29 –Ω–æ—è–±—Ä—è 2025):
- ‚úÖ **–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞** (161 –∏–Ω–¥–µ–∫—Å, 100% FK –ø–æ–∫—Ä—ã—Ç–∏–µ)
- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∞ –≤ 2-100 —Ä–∞–∑**
- ‚úÖ **Middleware –∑–∞—â–∏—Ç–∞** —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ **–ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ production** (OAuth, SEO, migrations)

> **üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ –¥–∏–∑–∞–π–Ω–µ:** –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Ä–µ–¥–∏–∑–∞–π–Ω UI/UX. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Å–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª—å–Ω–æ–π –æ–±–æ–ª–æ—á–∫–∏ (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, —Å—Ç–∏–ª–∏, layout). –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º–∏. –≠—Ç–æ —É—á—Ç–µ–Ω–æ –ø—Ä–∏ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π.

---

## 1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ üî¥

### 1.1 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Row Level Security (RLS)

**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –¢–∞–±–ª–∏—Ü—ã `collection_items` –∏ `auto_generated_routes_log` –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫—Ä—ã—Ç—ã –±–µ–∑ RLS
- 6 —Ç–∞–±–ª–∏—Ü –∏–º–µ—é—Ç RLS –≤–∫–ª—é—á–µ–Ω, –Ω–æ –±–µ–∑ –ø–æ–ª–∏—Ç–∏–∫:
  - `blog_post_reactions`
  - `blog_post_routes`
  - `blog_post_tags`
  - `blog_reading_stats`
  - `news_post_buildings`
  - `user_follows`

**–†–∏—Å–∫–∏:**
- –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è —á—É–∂–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π
- –£—Ç–µ—á–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–∏–º–µ—Ä –¥–ª—è collection_items
ALTER TABLE collection_items ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view items in their own or public collections"
ON collection_items FOR SELECT
USING (
  EXISTS (
    SELECT 1 FROM user_collections
    WHERE user_collections.id = collection_items.collection_id
    AND (user_collections.user_id = auth.uid() OR user_collections.is_public = true)
  )
);

CREATE POLICY "Users can manage items in their own collections"
ON collection_items FOR ALL
USING (
  EXISTS (
    SELECT 1 FROM user_collections
    WHERE user_collections.id = collection_items.collection_id
    AND user_collections.user_id = auth.uid()
  )
);
```

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** –î–æ –∑–∞–ø—É—Å–∫–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

---

### 1.2 Security Definer Views

**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏: –í–´–°–û–ö–ò–ô**

**–°—Ç–∞—Ç—É—Å: ‚úÖ –ù–ï –ü–†–ò–ú–ï–ù–ò–ú–û (29 –Ω–æ—è–±—Ä—è 2025)**

**–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:**
–ü–æ—Å–ª–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤—ã—è—Å–Ω–∏–ª–æ—Å—å, —á—Ç–æ **Views (–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è) –≤ PostgreSQL –ù–ï –ò–ú–ï–Æ–¢ –∞—Ç—Ä–∏–±—É—Ç–∞ SECURITY DEFINER**. –≠—Ç–æ—Ç –∞—Ç—Ä–∏–±—É—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π (functions), –Ω–æ –Ω–µ –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π.

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ views:**
- `collection_stats` ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç, owner: postgres
- `collection_items_detailed` ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç, owner: postgres
- `buildings_with_audio` ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç, owner: postgres
- `collections_with_stats` ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç, owner: postgres
- `collection_buildings_detailed` ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç, owner: postgres

**–í—ã–≤–æ–¥:**
- ‚úÖ –í—Å–µ 5 views —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Views –≤ PostgreSQL –Ω–µ –∏–º–µ—é—Ç SECURITY DEFINER (—ç—Ç–æ –∞—Ç—Ä–∏–±—É—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π)
- ‚úÖ Views —É–≤–∞–∂–∞—é—Ç RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–∞–∑–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞:**
```sql
-- SECURITY DEFINER –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π:
CREATE FUNCTION my_func() RETURNS void
SECURITY DEFINER  -- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
AS $$ ... $$;

-- –î–ª—è views —ç—Ç–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
CREATE VIEW my_view AS  -- ‚ùå SECURITY DEFINER –Ω–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å –∫ view
SELECT * FROM table;
```

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:** –î–∞–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º –ø–æ–Ω–∏–º–∞–Ω–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã PostgreSQL. –ù–∏–∫–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (false positive)

---

### 1.3 –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏: –°–†–ï–î–ù–ò–ô**

**–°—Ç–∞—Ç—É—Å: ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û (29 –Ω–æ—è–±—Ä—è 2025)**

**–ü—Ä–æ–±–ª–µ–º–∞:**
58 —Ñ—É–Ω–∫—Ü–∏–π –ë–î –∏–º–µ–ª–∏ –∏–∑–º–µ–Ω—è–µ–º—ã–π `search_path`, —á—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ —Ä–∏—Å–∫ schema poisoning –∞—Ç–∞–∫.

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è **027_fix_function_search_path.sql**:

```sql
-- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –±–µ–∑–æ–ø–∞—Å–Ω—ã–π search_path –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
ALTER FUNCTION update_building_rating() SET search_path = '';
ALTER FUNCTION handle_new_user() SET search_path = '';
ALTER FUNCTION update_route_priority_score() SET search_path = '';
-- ... –∏ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ó–∞—â–∏—â–µ–Ω–æ **59 —Ñ—É–Ω–∫—Ü–∏–π** (100% –¥–æ—Å—Ç—É–ø–Ω—ã—Ö)
- ‚úÖ –í—Å–µ 12 SECURITY DEFINER —Ñ—É–Ω–∫—Ü–∏–π –∑–∞—â–∏—â–µ–Ω—ã
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—É—Å—Ç–æ–π search_path (`SET search_path = ''`)
- ‚úÖ –ò—Å–∫–ª—é—á—ë–Ω —Ä–∏—Å–∫ schema poisoning –∞—Ç–∞–∫
- ‚úÖ –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ `check_function_search_path()` —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–§–∞–π–ª:** `database/migrations/027_fix_function_search_path.sql`

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

---

### 1.4 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Middleware –∑–∞—â–∏—Ç—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤

**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏: –í–´–°–û–ö–ò–ô**

**–°—Ç–∞—Ç—É—Å: ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ 29 –Ω–æ—è–±—Ä—è 2025)**

**–ü—Ä–æ–±–ª–µ–º–∞:**
–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª —Ñ–∞–π–ª `middleware.ts` –¥–ª—è –∑–∞—â–∏—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∏ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:**
–§–∞–π–ª `src/middleware.ts` —É–∂–µ —Å–æ–∑–¥–∞–Ω –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω:
```typescript
import { createServerClient } from '@supabase/ssr'
import { NextResponse, type NextRequest } from 'next/server'

export async function middleware(request: NextRequest) {
  const { pathname } = request.nextUrl

  // –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
  const protectedRoutes = ['/admin', '/settings', '/profile/edit']
  const isProtectedRoute = protectedRoutes.some(route => pathname.startsWith(route))

  if (isProtectedRoute) {
    const response = NextResponse.next()
    const supabase = createServerClient(
      process.env.NEXT_PUBLIC_SUPABASE_URL!,
      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
      {
        cookies: {
          get: (name) => request.cookies.get(name)?.value,
          set: (name, value, options) => {
            response.cookies.set(name, value, options)
          },
          remove: (name, options) => {
            response.cookies.delete(name)
          },
        },
      }
    )

    const { data: { session } } = await supabase.auth.getSession()

    if (!session) {
      const redirectUrl = new URL('/auth/login', request.url)
      redirectUrl.searchParams.set('redirectedFrom', pathname)
      return NextResponse.redirect(redirectUrl)
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
    if (pathname.startsWith('/admin')) {
      const { data: profile } = await supabase
        .from('profiles')
        .select('role')
        .eq('id', session.user.id)
        .single()

      if (profile?.role !== 'admin' && profile?.role !== 'moderator') {
        return NextResponse.redirect(new URL('/', request.url))
      }
    }

    return response
  }

  return NextResponse.next()
}

export const config = {
  matcher: ['/admin/:path*', '/settings/:path*', '/profile/edit/:path*']
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
- ‚úÖ –§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: `src/middleware.ts`
- ‚úÖ –ó–∞—â–∏—â–µ–Ω—ã –º–∞—Ä—à—Ä—É—Ç—ã: `/admin`, `/settings`, `/profile/edit`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/auth` –µ—Å–ª–∏ –Ω–µ—Ç —Å–µ—Å—Å–∏–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏: —Ç–æ–ª—å–∫–æ `admin` –∏ `moderator` –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `@supabase/ssr` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å cookies –≤ SSR
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω `matcher` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∏ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞—â–∏—â–µ–Ω—ã middleware.

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

---

### 1.5 –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Supabase

**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏: –°–†–ï–î–ù–ò–ô**

**–°—Ç–∞—Ç—É—Å: ‚è≥ –¢–†–ï–ë–£–ï–¢ –†–£–ß–ù–û–ô –ù–ê–°–¢–†–û–ô–ö–ò**

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå Leaked Password Protection –æ—Ç–∫–ª—é—á–µ–Ω–∞ (—Ç—Ä–µ–±—É–µ—Ç Pro –ø–ª–∞–Ω - $25/–º–µ—Å)
- ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Ç–æ–¥–æ–≤ MFA (—Ç–æ–ª—å–∫–æ TOTP –¥–æ—Å—Ç—É–ø–µ–Ω)
- ‚ö†Ô∏è PostgreSQL Update - –æ–ø—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ Dashboard

**–ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å:**

1. **Leaked Password Protection** (—Ç—Ä–µ–±—É–µ—Ç Pro –ø–ª–∞–Ω):
   - **–°—Ç–∞—Ç—É—Å:** ‚è≥ –û—Ç–ª–æ–∂–µ–Ω–æ –¥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ Pro
   - **–î–µ–π—Å—Ç–≤–∏–µ:** Supabase Dashboard ‚Üí Authentication ‚Üí Settings ‚Üí Enable
   - **–°—Ç–æ–∏–º–æ—Å—Ç—å:** $25/–º–µ—Å (–≤—Ö–æ–¥–∏—Ç –≤ Pro –ø–ª–∞–Ω)
   - **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –°–º. SUPABASE_MANUAL_SETTINGS.md

2. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ MFA –º–µ—Ç–æ–¥—ã** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   - **SMS MFA:** –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç
   - **WebAuthn/Passkeys:** –î–æ—Å—Ç—É–ø–Ω–æ, –Ω–æ –Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
   - **–°—Ç–∞—Ç—É—Å:** ‚è≥ –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

3. **PostgreSQL Update:**
   - **–°—Ç–∞—Ç—É—Å:** ‚ùì –û–ø—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ Dashboard
   - **–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:** 15.8.1.102
   - **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Supabase –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç PostgreSQL
   - **–î–µ–π—Å—Ç–≤–∏–µ:** –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç Supabase

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- Free plan –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω –¥–ª—è soft launch
- –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∏ –ø–æ—è–≤–ª–µ–Ω–∏—è revenue –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ Pro plan
- Leaked Password Protection –≤–∫–ª—é—á–∏—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ Pro

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ‚è≥ –ü–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ Pro –ø–ª–∞–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

### 1.6 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ deprecated –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ Supabase –∫–ª–∏–µ–Ω—Ç–∞

**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏: –°–†–ï–î–ù–ò–ô**

**–°—Ç–∞—Ç—É—Å: ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ 29 –Ω–æ—è–±—Ä—è 2025)**

**–ü—Ä–æ–±–ª–µ–º–∞:**
–§–∞–π–ª `src/lib/permissions.ts` –º–æ–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π `supabase` –∫–ª–∏–µ–Ω—Ç –≤–º–µ—Å—Ç–æ —Ñ–∞–±—Ä–∏—á–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞:**
```typescript
// src/lib/permissions.ts - –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï
import { createServerClient } from './supabase-server'  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ

export async function checkEditPermissions(
  contentType: 'building' | 'route',
  contentId: string,
  userId: string | null
): Promise<EditPermissions> {
  // –°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–ª–∏–µ–Ω—Ç
  const supabase = await createServerClient()  // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∞–±—Ä–∏—á–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –§–∞–π–ª —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `createServerClient()` –≤–º–µ—Å—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÖ –ù–µ—Ç —É—Ç–µ—á–µ–∫ Realtime –ø–æ–¥–ø–∏—Å–æ–∫
- ‚úÖ –ü–æ–ª–Ω–∞—è SSR —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:** –ö–æ–¥ —É–∂–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç best practices, –Ω–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ‚úÖ –£–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

---

### 1.7 OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (Google, GitHub, Apple)

**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏: –í–´–°–û–ö–ò–ô (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)**

**–°—Ç–∞—Ç—É—Å: üîß –ö–û–î –ì–û–¢–û–í, –¢–†–ï–ë–£–ï–¢ –ù–ê–°–¢–†–û–ô–ö–ò –ü–†–û–í–ê–ô–î–ï–†–û–í**

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ email/–ø–∞—Ä–æ–ª—é. –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é—Ç OAuth –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

**–ß—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ:**
- ‚úÖ OAuth callback route —Å–æ–∑–¥–∞–Ω (`src/app/auth/callback/route.ts`)
- ‚úÖ –ö–Ω–æ–ø–∫–∏ OAuth –≤ AuthModal (Google, GitHub)
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ (OAUTH_SETUP_GUIDE.md)

**–ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è:**
- ‚è≥ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–º–µ–Ω (–Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è callback URLs)
- ‚è≥ –°–æ–∑–¥–∞—Ç—å OAuth –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Google Cloud Console –∏ GitHub
- ‚è≥ –î–æ–±–∞–≤–∏—Ç—å credentials –≤ Supabase Dashboard
- ‚è≥ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã:**

#### 1.7.1 Google OAuth (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç #1)

**–ü–æ—á–µ–º—É Google:**
- –°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä (70%+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
- –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ email –∏ –∏–º–µ–Ω–∏

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Supabase:**

1. **Google Cloud Console** (https://console.cloud.google.com):
```
1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
2. APIs & Services ‚Üí Credentials ‚Üí Create Credentials ‚Üí OAuth 2.0 Client ID
3. Application type: Web application
4. Authorized redirect URIs:
   https://jkozshkubprsvkayfvhf.supabase.co/auth/v1/callback
```

2. **Supabase Dashboard:**
```
Authentication ‚Üí Providers ‚Üí Google
- Enable Google provider
- Client ID: [your-client-id]
- Client Secret: [your-client-secret]
```

3. **–ö–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:**
```typescript
// src/components/AuthModal.tsx
import { createClient } from '@/lib/supabase'

const supabase = createClient()

const signInWithGoogle = async () => {
  const { data, error } = await supabase.auth.signInWithOAuth({
    provider: 'google',
    options: {
      redirectTo: `${window.location.origin}/auth/callback`,
      queryParams: {
        access_type: 'offline',
        prompt: 'consent',
      }
    }
  })

  if (error) {
    toast.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏')
  }
}

// –í JSX
<button onClick={signInWithGoogle} className="...">
  <GoogleIcon />
  –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
</button>
```

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 1 –Ω–µ–¥–µ–ª—è –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

---

#### 1.7.2 GitHub OAuth (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç #2)

**–ü–æ—á–µ–º—É GitHub:**
- –ü–æ–ø—É–ª—è—Ä–µ–Ω —Å—Ä–µ–¥–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏
- –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
- –•–æ—Ä–æ—à–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```
1. GitHub Settings ‚Üí Developer settings ‚Üí OAuth Apps
2. Homepage URL: https://archiroutes.com
3. Callback URL: https://jkozshkubprsvkayfvhf.supabase.co/auth/v1/callback
```

**–ö–æ–¥:**
```typescript
const signInWithGitHub = async () => {
  const { error } = await supabase.auth.signInWithOAuth({
    provider: 'github',
    options: {
      redirectTo: `${window.location.origin}/auth/callback`
    }
  })
}
```

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 2 –Ω–µ–¥–µ–ª–∏ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

---

#### 1.7.3 Apple Sign In (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç #3)

**–ü–æ—á–µ–º—É Apple:**
- –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- –ü–æ–ø—É–ª—è—Ä–µ–Ω —Å—Ä–µ–¥–∏ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ Apple —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –¢—Ä–µ–±—É–µ—Ç Apple Developer –∞–∫–∫–∞—É–Ω—Ç ($99/–≥–æ–¥)
- –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- –û–±—è–∑–∞—Ç–µ–ª–µ–Ω –µ—Å–ª–∏ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏–Ω—ã –≤ iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ 2-3 –º–µ—Å—è—Ü–∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞, –µ—Å–ª–∏ –±—É–¥–µ—Ç iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

---

#### 1.7.4 Callback Route

**–°—Ç–∞—Ç—É—Å: ‚úÖ –£–ñ–ï –°–û–ó–î–ê–ù**

**–§–∞–π–ª:** `src/app/auth/callback/route.ts`

```typescript
import { createClient } from '@/lib/supabase'
import { NextResponse } from 'next/server'

export async function GET(request: Request) {
  const requestUrl = new URL(request.url)
  const code = requestUrl.searchParams.get('code')
  const origin = requestUrl.origin

  if (code) {
    const supabase = createClient()
    await supabase.auth.exchangeCodeForSession(code)
  }

  // Redirect to home or profile
  return NextResponse.redirect(`${origin}/profile`)
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ Callback route —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç OAuth –∫–æ–¥
- ‚úÖ –°–æ–∑–¥–∞—ë—Ç —Å–µ—Å—Å–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

---

### 1.8 Extension –≤ public schema

**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏: –ù–ò–ó–ö–ò–ô**

**–°—Ç–∞—Ç—É—Å: ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û (29 –Ω–æ—è–±—Ä—è 2025)**

**–ü—Ä–æ–±–ª–µ–º–∞:**
Extension `pg_trgm` –∏ –¥—Ä—É–≥–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –±—ã–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ `public` —Å—Ö–µ–º–µ, —á—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç PostgreSQL best practices.

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è **028_move_extensions_to_schema.sql**:

```sql
-- –°–æ–∑–¥–∞–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
CREATE SCHEMA IF NOT EXISTS extensions;

-- –ü–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤—Å–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
ALTER EXTENSION pg_trgm SET SCHEMA extensions;
ALTER EXTENSION unaccent SET SCHEMA extensions;
ALTER EXTENSION cube SET SCHEMA extensions;
ALTER EXTENSION earthdistance SET SCHEMA extensions;

-- –û–±–Ω–æ–≤–ª–µ–Ω search_path
ALTER DATABASE postgres SET search_path TO public, extensions;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å—Ö–µ–º–∞ `extensions`
- ‚úÖ –ü–µ—Ä–µ–º–µ—â–µ–Ω–æ **4 —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è** –∏–∑ `public` –≤ `extensions`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `search_path` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ PostgreSQL best practices
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ë–î

**–§–∞–π–ª:** `database/migrations/028_move_extensions_to_schema.sql`

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

---

## 2. –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ‚ö°

### 2.1 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π

**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏: –í–´–°–û–ö–ò–ô**

**–°—Ç–∞—Ç—É—Å: ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û (29 –Ω–æ—è–±—Ä—è 2025)**

**–ü—Ä–æ–±–ª–µ–º–∞:**
30+ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π –±–µ–∑ –ø–æ–∫—Ä—ã–≤–∞—é—â–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –º–µ–¥–ª–µ–Ω–Ω—ã–º JOIN –æ–ø–µ—Ä–∞—Ü–∏—è–º.

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è **029_add_missing_fk_indexes.sql** —Å 14 –∏–Ω–¥–µ–∫—Å–∞–º–∏ –¥–ª—è –≤—Å–µ—Ö FK –±–µ–∑ –ø–æ–∫—Ä—ã—Ç–∏—è:

```sql
-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤
CREATE INDEX idx_auto_generated_routes_log_generated_route_id ON auto_generated_routes_log(generated_route_id);
CREATE INDEX idx_auto_generated_routes_log_template_id ON auto_generated_routes_log(template_id);
CREATE INDEX idx_auto_route_templates_created_by ON auto_route_templates(created_by);
CREATE INDEX idx_route_generation_logs_generated_route_id ON route_generation_logs(generated_route_id);
CREATE INDEX idx_route_generation_logs_triggered_by ON route_generation_logs(triggered_by);
CREATE INDEX idx_route_generation_schedules_created_by ON route_generation_schedules(created_by);
CREATE INDEX idx_route_generation_schedules_template_id ON route_generation_schedules(template_id);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤
CREATE INDEX idx_route_publication_requests_requested_by ON route_publication_requests(requested_by);
CREATE INDEX idx_route_publication_requests_reviewed_by ON route_publication_requests(reviewed_by);
CREATE INDEX idx_route_publication_requests_route_id ON route_publication_requests(route_id);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤, –Ω–æ–≤–æ—Å—Ç–µ–π –∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
CREATE INDEX idx_route_templates_created_by ON route_templates(created_by);
CREATE INDEX idx_news_posts_author_id ON news_posts(author_id);
CREATE INDEX idx_news_grid_blocks_created_by ON news_grid_blocks(created_by);
CREATE INDEX idx_routes_duplicate_of ON routes(duplicate_of);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ **100% –ø–æ–∫—Ä—ã—Ç–∏–µ:** 93 –∏–∑ 93 –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç –∏–Ω–¥–µ–∫—Å—ã
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `check_missing_fk_indexes()` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –û–∂–∏–¥–∞–µ–º–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ JOIN –æ–ø–µ—Ä–∞—Ü–∏–π –≤ 10-100 —Ä–∞–∑

**–§–∞–π–ª:** `database/migrations/029_add_missing_fk_indexes.sql`

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

---

### 2.2 –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏

**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏: –°–†–ï–î–ù–ò–ô**

**–°—Ç–∞—Ç—É—Å: ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û (27 –Ω–æ—è–±—Ä—è 2025)**

**–ü—Ä–æ–±–ª–µ–º–∞:**
70+ RLS –ø–æ–ª–∏—Ç–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `auth.uid()` –Ω–∞–ø—Ä—è–º—É—é –≤–º–µ—Å—Ç–æ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞ `(SELECT auth.uid())`, —á—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –æ—Ü–µ–Ω–∫—É —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏.

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è **026_optimize_rls_policies.sql**:

**–ë—ã–ª–æ (–Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ):**
```sql
CREATE POLICY "Users can update own profile"
ON profiles FOR UPDATE
USING (id = auth.uid());  -- ‚ùå –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏
```

**–°—Ç–∞–ª–æ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ):**
```sql
CREATE POLICY "Users can update own profile"
ON profiles FOR UPDATE
USING (id = (SELECT auth.uid()));  -- ‚úÖ –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ **31 RLS –ø–æ–ª–∏—Ç–∏–∫–∞** –¥–ª—è 8 —Ç–∞–±–ª–∏—Ü:
  - `profiles` (3 –ø–æ–ª–∏—Ç–∏–∫–∏)
  - `building_reviews` (6 –ø–æ–ª–∏—Ç–∏–∫)
  - `routes` (4 –ø–æ–ª–∏—Ç–∏–∫–∏)
  - `notifications` (3 –ø–æ–ª–∏—Ç–∏–∫–∏)
  - `route_completions` (2 –ø–æ–ª–∏—Ç–∏–∫–∏)
  - `user_collections` (4 –ø–æ–ª–∏—Ç–∏–∫–∏)
  - `collection_items` (4 –ø–æ–ª–∏—Ç–∏–∫–∏)
  - `user_follows` (5 –ø–æ–ª–∏—Ç–∏–∫)
- ‚úÖ –û–∂–∏–¥–∞–µ–º–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ **2-5 —Ä–∞–∑**
- ‚úÖ –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ CPU –ë–î

**–§–∞–π–ª:** `database/migrations/026_optimize_rls_policies.sql`

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

---

### 2.3 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º –¥–ª—è –ø–æ–∏—Å–∫–∞

**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏: –ù–ò–ó–ö–ò–ô**

**–°—Ç–∞—Ç—É—Å: ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û (27 –Ω–æ—è–±—Ä—è 2025)**

**–ü—Ä–æ–±–ª–µ–º–∞:**
–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ —Å–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞.

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è **025_add_search_indexes.sql**:

```sql
-- –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∑–¥–∞–Ω–∏–π
CREATE INDEX idx_buildings_city_country ON buildings(city, country);
CREATE INDEX idx_buildings_style ON buildings(architectural_style);
CREATE INDEX idx_buildings_year ON buildings(year_built);

-- –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
CREATE INDEX idx_routes_city_country ON routes(city, country);
CREATE INDEX idx_routes_visibility_status ON routes(route_visibility, publication_status);
CREATE INDEX idx_routes_created_by_published ON routes(created_by, is_published);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π –∏ –ø–æ–¥–∫–∞—Å—Ç–æ–≤
CREATE INDEX idx_news_status_published ON architecture_news(status, published_at DESC);
CREATE INDEX idx_news_category ON architecture_news(category);
CREATE INDEX idx_podcasts_status_published ON podcast_episodes(status, published_at DESC);
CREATE INDEX idx_podcasts_series ON podcast_episodes(series_id, episode_number);

-- GIN –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_buildings_name_trgm ON buildings USING gin (name gin_trgm_ops);
CREATE INDEX idx_buildings_description_trgm ON buildings USING gin (description gin_trgm_ops);
CREATE INDEX idx_routes_name_trgm ON routes USING gin (name gin_trgm_ops);
CREATE INDEX idx_blog_posts_title_trgm ON blog_posts USING gin (title gin_trgm_ops);

-- GIST –∏–Ω–¥–µ–∫—Å –¥–ª—è –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
CREATE INDEX idx_buildings_location ON buildings USING gist (ll_to_earth(latitude, longitude));
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–æ **20 –∏–Ω–¥–µ–∫—Å–æ–≤** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞
- ‚úÖ **4 GIN –∏–Ω–¥–µ–∫—Å–∞** –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ (pg_trgm)
- ‚úÖ **1 GIST –∏–Ω–¥–µ–∫—Å** –¥–ª—è –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –û–∂–∏–¥–∞–µ–º–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ –≤ **50-100 —Ä–∞–∑**
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≥–æ—Ä–æ–¥—É, —Å—Ç—Ä–∞–Ω–µ, —Å—Ç–∏–ª—é, –≥–æ–¥—É
- ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –≤ —Ä–∞–¥–∏—É—Å–µ (earthdistance)

**–§–∞–π–ª:** `database/migrations/025_add_search_indexes.sql`

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

---

## 3. –ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è (i18n) üåç

> **üìù –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞:** –í–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º —è–∑—ã–∫–µ (—Ä—É—Å—Å–∫–∏–π). –ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–µ–ª–∞–µ—Ç—Å—è –û–î–ò–ù –†–ê–ó –∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å: —á–∏—Ç–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª –∏–ª–∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥. –ü–æ–∑–∂–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ —è–∑—ã–∫–æ–≤.

### 3.1 –î–≤—É—Ö—ä—è–∑—ã—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (–†—É—Å—Å–∫–∏–π + –ê–Ω–≥–ª–∏–π—Å–∫–∏–π)

**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏: –í–´–°–û–ö–ò–ô (–¥–ª—è –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏)**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ i18n –¥–ª—è UI
- –í–µ—Å—å UI —Ç–µ–∫—Å—Ç –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –ù–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –≤ –ë–î –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è:**

#### –ß–∞—Å—Ç—å 1: UI –ø–µ—Ä–µ–≤–æ–¥—ã (next-intl)

**–î–ª—è —á–µ–≥–æ:** –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∫–Ω–æ–ø–∫–∏, —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–∞–≤–∏–≥–∞—Ü–∏—è

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
npm install next-intl
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
src/
‚îú‚îÄ‚îÄ i18n/
‚îÇ   ‚îú‚îÄ‚îÄ config.ts
‚îÇ   ‚îú‚îÄ‚îÄ request.ts
‚îÇ   ‚îî‚îÄ‚îÄ locales/
‚îÇ       ‚îú‚îÄ‚îÄ ru/common.json
‚îÇ       ‚îî‚îÄ‚îÄ en/common.json
‚îî‚îÄ‚îÄ app/
    ‚îî‚îÄ‚îÄ [locale]/
        ‚îú‚îÄ‚îÄ layout.tsx
        ‚îî‚îÄ‚îÄ page.tsx
```

**–ü—Ä–∏–º–µ—Ä `src/i18n/locales/ru/common.json`:**
```json
{
  "nav": {
    "home": "–ì–ª–∞–≤–Ω–∞—è",
    "buildings": "–ó–¥–∞–Ω–∏—è",
    "routes": "–ú–∞—Ä—à—Ä—É—Ç—ã"
  },
  "common": {
    "readOriginal": "–ß–∏—Ç–∞—Ç—å –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º —è–∑—ã–∫–µ",
    "readInEnglish": "Read in English"
  }
}
```

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 1-2 –Ω–µ–¥–µ–ª–∏

---

#### –ß–∞—Å—Ç—å 2: –¢–∞–±–ª–∏—Ü–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ –ë–î

**–î–ª—è —á–µ–≥–æ:** –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–∑–¥–∞–Ω–∏—è, –º–∞—Ä—à—Ä—É—Ç—ã, –±–ª–æ–≥–∏, –Ω–æ–≤–æ—Å—Ç–∏)

**–°—Ö–µ–º–∞ –ë–î:**
```sql
-- –¢–∞–±–ª–∏—Ü–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
CREATE TABLE content_translations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  entity_type TEXT NOT NULL,  -- 'building', 'route', 'blog_post', 'news_post', 'review'
  entity_id UUID NOT NULL,
  field_name TEXT NOT NULL,   -- 'name', 'description', 'content', etc.
  source_lang TEXT NOT NULL DEFAULT 'ru',
  target_lang TEXT NOT NULL,
  original_text TEXT NOT NULL,
  translated_text TEXT NOT NULL,
  translation_method TEXT NOT NULL, -- 'manual', 'google', 'deepl', 'gpt4'
  is_approved BOOLEAN DEFAULT FALSE,
  translated_by UUID,          -- ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ —Ä—É—á–Ω–æ–π –ø–µ—Ä–µ–≤–æ–¥
  translated_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(entity_type, entity_id, field_name, target_lang)
);

CREATE INDEX idx_translations_lookup
  ON content_translations(entity_type, entity_id, target_lang);

CREATE INDEX idx_translations_approval
  ON content_translations(is_approved, entity_type);

-- –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è updated_at
CREATE OR REPLACE FUNCTION update_translations_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_translations_updated_at
BEFORE UPDATE ON content_translations
FOR EACH ROW
EXECUTE FUNCTION update_translations_updated_at();
```

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 1 –Ω–µ–¥–µ–ª—è

---

### 3.2 –ü—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–≤–æ–¥–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è "–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –æ–¥–∏–Ω —Ä–∞–∑ –∏ —Ö—Ä–∞–Ω–∏—Ç—å":**

1. **–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:** –ö–æ–Ω—Ç–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º (–æ—Ä–∏–≥–∏–Ω–∞–ª)
2. **–ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π:** –î–µ–ª–∞–µ—Ç—Å—è –û–î–ò–ù –†–ê–ó –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `content_translations`
3. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —è–∑—ã–∫, —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª–∏–±–æ –æ—Ä–∏–≥–∏–Ω–∞–ª, –ª–∏–±–æ –ø–µ—Ä–µ–≤–æ–¥ –∏–∑ –ë–î

#### 3.2.1 –°–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–≤–æ–¥–∞

**`src/lib/translation-service.ts`:**
```typescript
import { createClient } from '@/lib/supabase'

export type TranslationMethod = 'google' | 'deepl' | 'gpt4' | 'manual'

export interface TranslateOptions {
  entityType: 'building' | 'route' | 'blog_post' | 'news_post' | 'review'
  entityId: string
  fieldName: string
  originalText: string
  sourceLang: string
  targetLang: string
  method?: TranslationMethod
}

export async function translateAndStore(options: TranslateOptions): Promise<string> {
  const {
    entityType,
    entityId,
    fieldName,
    originalText,
    sourceLang,
    targetLang,
    method = 'google'
  } = options

  const supabase = createClient()

  // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –ø–µ—Ä–µ–≤–æ–¥
  const { data: existing } = await supabase
    .from('content_translations')
    .select('translated_text')
    .eq('entity_type', entityType)
    .eq('entity_id', entityId)
    .eq('field_name', fieldName)
    .eq('target_lang', targetLang)
    .single()

  if (existing) {
    return existing.translated_text
  }

  // 2. –í—ã–ø–æ–ª–Ω—è–µ–º –ø–µ—Ä–µ–≤–æ–¥
  const translatedText = await performTranslation(
    originalText,
    sourceLang,
    targetLang,
    method
  )

  // 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
  await supabase.from('content_translations').insert({
    entity_type: entityType,
    entity_id: entityId,
    field_name: fieldName,
    source_lang: sourceLang,
    target_lang: targetLang,
    original_text: originalText,
    translated_text: translatedText,
    translation_method: method,
    is_approved: false  // –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
  })

  return translatedText
}

async function performTranslation(
  text: string,
  sourceLang: string,
  targetLang: string,
  method: TranslationMethod
): Promise<string> {
  switch (method) {
    case 'google':
      return translateWithGoogle(text, sourceLang, targetLang)
    case 'deepl':
      return translateWithDeepL(text, sourceLang, targetLang)
    case 'gpt4':
      return translateWithGPT4(text, sourceLang, targetLang)
    default:
      throw new Error(`Unknown translation method: ${method}`)
  }
}

// –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ç–æ–¥–æ–≤ –ø–µ—Ä–µ–≤–æ–¥–∞
async function translateWithGoogle(text: string, from: string, to: string): Promise<string> {
  // Google Cloud Translation API
  const response = await fetch(
    `https://translation.googleapis.com/language/translate/v2?key=${process.env.GOOGLE_TRANSLATE_API_KEY}`,
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ q: text, source: from, target: to })
    }
  )
  const data = await response.json()
  return data.data.translations[0].translatedText
}

async function translateWithDeepL(text: string, from: string, to: string): Promise<string> {
  // DeepL API
  const response = await fetch('https://api-free.deepl.com/v2/translate', {
    method: 'POST',
    headers: {
      'Authorization': `DeepL-Auth-Key ${process.env.DEEPL_API_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ text: [text], source_lang: from.toUpperCase(), target_lang: to.toUpperCase() })
  })
  const data = await response.json()
  return data.translations[0].text
}

async function translateWithGPT4(text: string, from: string, to: string): Promise<string> {
  // OpenAI GPT-4
  const response = await fetch('https://api.openai.com/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${process.env.OPENAI_API_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      model: 'gpt-4-turbo',
      messages: [
        {
          role: 'system',
          content: `Translate architectural content from ${from} to ${to}. Preserve technical terms.`
        },
        { role: 'user', content: text }
      ],
      temperature: 0.3
    })
  })
  const data = await response.json()
  return data.choices[0].message.content
}
```

---

#### 3.2.2 –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

**`src/lib/get-translated-content.ts`:**
```typescript
import { createClient } from '@/lib/supabase'

export async function getTranslatedContent(
  entityType: string,
  entityId: string,
  fieldName: string,
  targetLang: string,
  originalText: string
): Promise<string> {
  // –ï—Å–ª–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —è–∑—ã–∫, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª
  if (targetLang === 'ru') {
    return originalText
  }

  const supabase = createClient()

  const { data } = await supabase
    .from('content_translations')
    .select('translated_text')
    .eq('entity_type', entityType)
    .eq('entity_id', entityId)
    .eq('field_name', fieldName)
    .eq('target_lang', targetLang)
    .eq('is_approved', true)  // –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã
    .single()

  // –ï—Å–ª–∏ –ø–µ—Ä–µ–≤–æ–¥ –µ—Å—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ–≥–æ, –∏–Ω–∞—á–µ –æ—Ä–∏–≥–∏–Ω–∞–ª
  return data?.translated_text || originalText
}
```

---

#### 3.2.3 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

**–ü—Ä–∏–º–µ—Ä –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∑–¥–∞–Ω–∏—è:**
```typescript
'use client'

import { useEffect, useState } from 'react'
import { useParams } from 'next/navigation'
import { getTranslatedContent } from '@/lib/get-translated-content'

export default function BuildingDetail({ building }: { building: Building }) {
  const { locale } = useParams()  // 'ru' –∏–ª–∏ 'en'
  const [name, setName] = useState(building.name)
  const [description, setDescription] = useState(building.description)

  useEffect(() => {
    async function loadTranslations() {
      if (locale === 'en') {
        const translatedName = await getTranslatedContent(
          'building',
          building.id,
          'name',
          'en',
          building.name
        )
        const translatedDescription = await getTranslatedContent(
          'building',
          building.id,
          'description',
          'en',
          building.description
        )
        setName(translatedName)
        setDescription(translatedDescription)
      }
    }
    loadTranslations()
  }, [locale, building])

  return (
    <div>
      <h1>{name}</h1>
      <p>{description}</p>
    </div>
  )
}
```

---

### 3.3 –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏

**–°–æ–∑–¥–∞—Ç—å:** `src/app/[locale]/admin/translations/page.tsx`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
1. –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤
2. –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
3. –†—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
4. –ú–∞—Å—Å–æ–≤—ã–π –ø–µ—Ä–µ–≤–æ–¥ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
5. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤

**–ü—Ä–∏–º–µ—Ä UI:**
```typescript
export default function TranslationsAdmin() {
  return (
    <div>
      <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏</h1>

      {/* –§–∏–ª—å—Ç—Ä—ã */}
      <div>
        <select>
          <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
          <option value="building">–ó–¥–∞–Ω–∏—è</option>
          <option value="route">–ú–∞—Ä—à—Ä—É—Ç—ã</option>
          <option value="blog_post">–ë–ª–æ–≥</option>
          <option value="news_post">–ù–æ–≤–æ—Å—Ç–∏</option>
        </select>

        <select>
          <option value="pending">–û–∂–∏–¥–∞—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏</option>
          <option value="approved">–£—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã</option>
        </select>
      </div>

      {/* –¢–∞–±–ª–∏—Ü–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ */}
      <table>
        <thead>
          <tr>
            <th>–¢–∏–ø</th>
            <th>–ü–æ–ª–µ</th>
            <th>–û—Ä–∏–≥–∏–Ω–∞–ª (RU)</th>
            <th>–ü–µ—Ä–µ–≤–æ–¥ (EN)</th>
            <th>–ú–µ—Ç–æ–¥</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
          {/* ... */}
        </tbody>
      </table>
    </div>
  )
}
```

---

### 3.4 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

**–•—É–∫ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞:**

```typescript
// src/hooks/useAutoTranslate.ts
import { useEffect } from 'react'
import { translateAndStore } from '@/lib/translation-service'

export function useAutoTranslate(
  entityType: string,
  entityId: string,
  content: Record<string, string>,
  enabled: boolean = true
) {
  useEffect(() => {
    if (!enabled || !entityId) return

    async function autoTranslate() {
      for (const [fieldName, originalText] of Object.entries(content)) {
        if (originalText && originalText.trim()) {
          try {
            await translateAndStore({
              entityType,
              entityId,
              fieldName,
              originalText,
              sourceLang: 'ru',
              targetLang: 'en',
              method: 'google'  // –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å
            })
          } catch (error) {
            console.error(`Failed to translate ${fieldName}:`, error)
          }
        }
      }
    }

    autoTranslate()
  }, [entityId, enabled])
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```typescript
// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–¥–∞–Ω–∏—è
const { data: building } = await supabase
  .from('buildings')
  .insert({ name, description, ... })
  .select()
  .single()

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∏–º
useAutoTranslate('building', building.id, {
  name: building.name,
  description: building.description
})
```

---

### 3.5 –°—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –º–µ—Ç–æ–¥ –ø–µ—Ä–µ–≤–æ–¥–∞ –ø–æ —Ç–∏–ø—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞:**

| –¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞ | –ú–µ—Ç–æ–¥ | –ü—Ä–∏—á–∏–Ω–∞ | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|--------------|-------|---------|-----------|
| –û–ø–∏—Å–∞–Ω–∏—è –∑–¥–∞–Ω–∏–π | GPT-4 | –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã | $50-100/–º–µ—Å |
| –ë–ª–æ–≥ –ø–æ—Å—Ç—ã | GPT-4 | –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –∫–æ–Ω—Ç–µ–∫—Å—Ç | $30-50/–º–µ—Å |
| –ù–æ–≤–æ—Å—Ç–∏ | Google Translate | –°–∫–æ—Ä–æ—Å—Ç—å, –æ–±—ä–µ–º | $20-40/–º–µ—Å |
| –û—Ç–∑—ã–≤—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | Google Translate | –û–±—ä–µ–º, —Ü–µ–Ω–∞ | $50-100/–º–µ—Å |
| –ù–∞–∑–≤–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ | DeepL | –ö–∞—á–µ—Å—Ç–≤–æ | $10-20/–º–µ—Å |

**–ò—Ç–æ–≥–æ:** ~$160-310/–º–µ—Å –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –ü–µ—Ä–µ–≤–æ–¥—ã –¥–µ–ª–∞—é—Ç—Å—è –û–î–ò–ù –†–ê–ó –∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î
- –ù–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö API –≤—ã–∑–æ–≤–æ–≤
- –ú–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —É–ª—É—á—à–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã –≤—Ä—É—á–Ω—É—é
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —è–∑—ã–∫–æ–≤

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 3-4 –Ω–µ–¥–µ–ª–∏

---

## 4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ üöÄ

### 4.1 Bundle —Ä–∞–∑–º–µ—Ä

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- Next.js 15.3.4 ‚úÖ
- React 19 ‚úÖ
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∏–º–ø–æ—Ä—Ç—ã –¥–ª—è –∫–∞—Ä—Ç ‚úÖ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∏–º–ø–æ—Ä—Ç—ã –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
const BuildingModal = dynamic(() => import('@/components/BuildingModalNew'), {
  ssr: false,
  loading: () => <Skeleton />
})

const AudioPlayer = dynamic(() => import('@/components/AudioPlayer'), {
  ssr: false
})
```

### 4.2 Image –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```typescript
// next.config.ts - ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ
images: {
  remotePatterns: [
    {
      protocol: 'https',
      hostname: 'jkozshkubprsvkayfvhf.supabase.co',
      pathname: '/storage/v1/object/public/**',
    }
  ]
}
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WebP —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å thumbnails –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å blur placeholders

---

## 5. SEO –∏ Meta-—Ç–µ–≥–∏ üìà

### 5.1 –ë–∞–∑–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å:**

1. **robots.txt** ‚úÖ (—É–∂–µ –µ—Å—Ç—å `src/app/robots.ts`)
2. **sitemap.xml** - –°–æ–∑–¥–∞—Ç—å `src/app/sitemap.ts`:

```typescript
import { MetadataRoute } from 'next'

export default async function sitemap(): Promise<MetadataRoute.Sitemap> {
  // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ –∑–¥–∞–Ω–∏—è, –º–∞—Ä—à—Ä—É—Ç—ã, –±–ª–æ–≥–∏
  const buildings = await getAllPublicBuildings()
  const routes = await getAllPublicRoutes()
  const blogPosts = await getAllPublishedBlogPosts()

  return [
    {
      url: 'https://archiroutes.com',
      lastModified: new Date(),
      changeFrequency: 'daily',
      priority: 1,
    },
    {
      url: 'https://archiroutes.com/buildings',
      lastModified: new Date(),
      changeFrequency: 'daily',
      priority: 0.8,
    },
    ...buildings.map(b => ({
      url: `https://archiroutes.com/buildings/${b.id}`,
      lastModified: b.updated_at,
      changeFrequency: 'weekly',
      priority: 0.7,
    })),
    // ... routes, blog posts
  ]
}
```

3. **Open Graph —Ç–µ–≥–∏** –≤ –∫–∞–∂–¥–æ–º layout/page:

```typescript
export const metadata: Metadata = {
  title: 'Archi-Routes - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã',
  description: '–û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —à–µ–¥–µ–≤—Ä—ã —Å –∞—É–¥–∏–æ–≥–∏–¥–∞–º–∏',
  openGraph: {
    title: 'Archi-Routes',
    description: '–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã —Å –∞—É–¥–∏–æ–≥–∏–¥–∞–º–∏',
    images: ['/og-image.jpg'],
  },
  twitter: {
    card: 'summary_large_image',
  }
}
```

**–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 1-2 –Ω–µ–¥–µ–ª–∏ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

---

## 6. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —Ö–æ—Å—Ç–∏–Ω–≥ üåê

### 6.1 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ö–æ—Å—Ç–∏–Ω–≥—É

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: Vercel (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è Next.js)**

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–∞—Ç–∏–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Next.js
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π CI/CD
- Edge Functions
- Image Optimization
- Analytics –≤—Å—Ç—Ä–æ–µ–Ω

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
- Netlify (—Ö–æ—Ä–æ—à–æ –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏)
- AWS Amplify (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ AWS –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- Railway (–ø—Ä–æ—Å—Ç–æ—Ç–∞ + –±—é–¥–∂–µ—Ç)

### 6.2 –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞ production:**
```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...

# Mapbox (–¥–ª—è –∫–∞—Ä—Ç)
NEXT_PUBLIC_MAPBOX_ACCESS_TOKEN=pk.eyJ...

# Google Translation (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
GOOGLE_TRANSLATE_API_KEY=AIza...

# OpenAI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
OPENAI_API_KEY=sk-proj-...

# Analytics (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
NEXT_PUBLIC_GA_ID=G-XXXXXXXXXX
```

### 6.3 –î–æ–º–µ–Ω –∏ SSL

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –ö—É–ø–∏—Ç—å –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, archiroutes.com)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å DNS –∑–∞–ø–∏—Å–∏
- ‚úÖ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ Vercel)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å redirect —Å www –Ω–∞ non-www (–∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç)

---

## 7. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ üìä

### 7.1 –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

1. **Vercel Analytics** (–≤—Å—Ç—Ä–æ–µ–Ω) - Performance
2. **Supabase Dashboard** - Database metrics
3. **Google Analytics 4** - User behavior
4. **Sentry** - Error tracking

```typescript
// src/lib/sentry.ts
import * as Sentry from '@sentry/nextjs'

Sentry.init({
  dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,
  environment: process.env.NODE_ENV,
  tracesSampleRate: 0.1,
})
```

### 7.2 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```typescript
// src/lib/logger.ts
export const logger = {
  info: (message: string, meta?: any) => {
    console.log(JSON.stringify({ level: 'info', message, ...meta, timestamp: new Date() }))
  },
  error: (message: string, error?: any) => {
    console.error(JSON.stringify({ level: 'error', message, error, timestamp: new Date() }))
  }
}
```

---

## 8. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ üíæ

### 8.1 Supabase Backups

**–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω:** Free tier (7 –¥–Ω–µ–π retention)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –û–±–Ω–æ–≤–∏—Ç—å –¥–æ Pro plan ($25/–º–µ—Å) - 30 –¥–Ω–µ–π retention
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ daily backups
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑ –≤ –º–µ—Å—è—Ü

### 8.2 Storage Backups

```sql
-- –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
CREATE OR REPLACE FUNCTION export_critical_data()
RETURNS TABLE (
  entity_type TEXT,
  data JSONB
) AS $$
BEGIN
  RETURN QUERY
  SELECT 'buildings'::TEXT, jsonb_agg(row_to_json(buildings.*))
  FROM buildings WHERE verified = TRUE
  UNION ALL
  SELECT 'routes'::TEXT, jsonb_agg(row_to_json(routes.*))
  FROM routes WHERE is_published = TRUE;
END;
$$ LANGUAGE plpgsql;
```

---

## 9. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ üß™

### 9.1 E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å Playwright (—É–∂–µ –µ—Å—Ç—å MCP —Å–µ—Ä–≤–µ—Ä!):

```typescript
// tests/e2e/auth.spec.ts
import { test, expect } from '@playwright/test'

test('user can sign in', async ({ page }) => {
  await page.goto('http://localhost:3000')
  await page.click('text=–í–æ–π—Ç–∏')
  await page.fill('input[type="email"]', 'test@example.com')
  await page.fill('input[type="password"]', 'password')
  await page.click('button[type="submit"]')
  await expect(page).toHaveURL('/profile')
})
```

### 9.2 –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:**
```
Email: testguide@archiroutes.com
Password: TestGuide2024!
```

---

## 10. –ß–µ–∫-–ª–∏—Å—Ç –∑–∞–ø—É—Å–∫–∞ ‚úÖ

### –î–æ –∑–∞–ø—É—Å–∫–∞ (–∫—Ä–∏—Ç–∏—á–Ω–æ):

- [x] ‚úÖ **–£—Å—Ç—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (—Ä–∞–∑–¥–µ–ª 1.1-1.4)** - –í–´–ü–û–õ–ù–ï–ù–û 27.11.2025
  - ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –¥–ª—è 7 —Ç–∞–±–ª–∏—Ü
  - ‚úÖ Security Definer views –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã (5 views)
  - ‚úÖ Middleware –∑–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞
  - ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞
- [x] ‚úÖ **–°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –≤—Å–µ—Ö FK (—Ä–∞–∑–¥–µ–ª 2.1)** - –í–´–ü–û–õ–ù–ï–ù–û 29.11.2025
  - ‚úÖ 14 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ —Å–æ–∑–¥–∞–Ω—ã (–º–∏–≥—Ä–∞—Ü–∏—è 029)
  - ‚úÖ 100% –ø–æ–∫—Ä—ã—Ç–∏–µ: 93 –∏–∑ 93 –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω—ã
  - ‚úÖ –§—É–Ω–∫—Ü–∏—è check_missing_fk_indexes() –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [x] ‚úÖ **–°–æ–∑–¥–∞—Ç—å middleware.ts –¥–ª—è –∑–∞—â–∏—Ç—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤ (—Ä–∞–∑–¥–µ–ª 1.4)** - –ü–†–û–í–ï–†–ï–ù–û 29.11.2025
  - ‚úÖ –§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
  - ‚úÖ –ó–∞—â–∏—â–µ–Ω—ã /admin, /settings, /profile
  - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
  - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç @supabase/ssr –¥–ª—è SSR —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- [x] ‚úÖ **–í–∫–ª—é—á–∏—Ç—å RLS –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü (—Ä–∞–∑–¥–µ–ª 1.1)** - –í–´–ü–û–õ–ù–ï–ù–û 27.11.2025
  - ‚úÖ 7 —Ç–∞–±–ª–∏—Ü —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º RLS
  - ‚úÖ 20+ –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [x] ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å SECURITY DEFINER views (—Ä–∞–∑–¥–µ–ª 1.2)** - –ü–†–û–í–ï–†–ï–ù–û 29.11.2025
  - ‚úÖ Views –≤ PostgreSQL –Ω–µ –∏–º–µ—é—Ç –∞—Ç—Ä–∏–±—É—Ç–∞ SECURITY DEFINER (—Ç–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–∏)
  - ‚úÖ –í—Å–µ 5 views —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ —É–≤–∞–∂–∞—é—Ç RLS –ø–æ–ª–∏—Ç–∏–∫–∏
  - ‚úÖ –ù–∏–∫–∞–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ (false positive)
- [ ] **–ö—É–ø–∏—Ç—å –¥–æ–º–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å DNS**
  - üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ OAUTH_SETUP_GUIDE.md
  - üìù –ü—Ä–µ–¥–ª–æ–∂–µ–Ω—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã: Namecheap, Cloudflare, Google Domains
- [ ] **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å production –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
  - üìù –°–ø–∏—Å–æ–∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Ä–∞–∑–¥–µ–ª–µ 6.2
- [ ] **–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
  - ‚úÖ Middleware –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
  - ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
  - ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- [ ] **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã**
  - üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ 7

### –ü–µ—Ä–≤–∞—è –Ω–µ–¥–µ–ª—è –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

- [ ] –í–∫–ª—é—á–∏—Ç—å Leaked Password Protection (—Ä–∞–∑–¥–µ–ª 1.5)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å PostgreSQL –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ (—Ä–∞–∑–¥–µ–ª 1.5)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Google Analytics
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Sentry –¥–ª—è error tracking
- [x] ‚úÖ **–°–æ–∑–¥–∞—Ç—å sitemap.xml (—Ä–∞–∑–¥–µ–ª 5.1)** - –í–´–ü–û–õ–ù–ï–ù–û 27.11.2025
  - ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ Supabase
  - ‚úÖ –í–∫–ª—é—á–µ–Ω—ã: –∑–¥–∞–Ω–∏—è, –º–∞—Ä—à—Ä—É—Ç—ã, –±–ª–æ–≥, –Ω–æ–≤–æ—Å—Ç–∏
- [x] ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å Open Graph —Ç–µ–≥–∏** - –í–´–ü–û–õ–ù–ï–ù–û 27.11.2025
  - ‚úÖ –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä OG —Ç–µ–≥–æ–≤ –≤ layout.tsx
  - ‚úÖ Dynamic metadata –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü –∑–¥–∞–Ω–∏–π
  - ‚úÖ Twitter Cards –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü

### –ü–µ—Ä–≤—ã–π –º–µ—Å—è—Ü:

- [x] ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏ (—Ä–∞–∑–¥–µ–ª 2.2)** - –í–´–ü–û–õ–ù–ï–ù–û 27.11.2025
  - ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è 026 –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
  - ‚úÖ 31 RLS –ø–æ–ª–∏—Ç–∏–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è 8 —Ç–∞–±–ª–∏—Ü
  - ‚úÖ –ó–∞–º–µ–Ω–µ–Ω auth.uid() –Ω–∞ (SELECT auth.uid())
  - ‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 2-5 —Ä–∞–∑
- [x] ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã (—Ä–∞–∑–¥–µ–ª 2.3)** - –í–´–ü–û–õ–ù–ï–ù–û 27.11.2025
  - ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è 025 –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
  - ‚úÖ –°–æ–∑–¥–∞–Ω–æ 20 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
  - ‚úÖ 4 GIN –∏–Ω–¥–µ–∫—Å–∞ –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
  - ‚úÖ 1 GIST –∏–Ω–¥–µ–∫—Å –¥–ª—è –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
  - ‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ –≤ 50-100 —Ä–∞–∑
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å search_path –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö (—Ä–∞–∑–¥–µ–ª 1.3)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å permissions.ts (—Ä–∞–∑–¥–µ–ª 1.6)
- [ ] –í–Ω–µ–¥—Ä–∏—Ç—å i18n —Å–∏—Å—Ç–µ–º—É (—Ä–∞–∑–¥–µ–ª 3.1)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (—Ä–∞–∑–¥–µ–ª 3.2)

### 2-3 –º–µ—Å—è—Ü–∞:

- [ ] –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å pg_trgm –∏–∑ public schema (—Ä–∞–∑–¥–µ–ª 1.7)
- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å bundle size
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å E2E —Ç–µ—Å—Ç—ã

---

## 11. –°—Ç–æ–∏–º–æ—Å—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã üí∞

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Å—Ç–∞—Ä—Ç):

| –°–µ—Ä–≤–∏—Å | –ü–ª–∞–Ω | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|--------|------|-----------|
| Supabase | Free | $0/–º–µ—Å |
| Vercel | Hobby | $0/–º–µ—Å |
| –î–æ–º–µ–Ω | .com | ~$12/–≥–æ–¥ |
| **–ò–¢–û–ì–û** | | **~$1/–º–µ—Å** |

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ä–æ—Å—Ç):

| –°–µ—Ä–≤–∏—Å | –ü–ª–∞–Ω | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|--------|------|-----------|
| Supabase | Pro | $25/–º–µ—Å |
| Vercel | Pro | $20/–º–µ—Å |
| Google Translate | Pay as you go | $100-200/–º–µ—Å |
| Sentry | Team | $26/–º–µ—Å |
| –î–æ–º–µ–Ω | .com | ~$12/–≥–æ–¥ |
| **–ò–¢–û–ì–û** | | **~$172-272/–º–µ—Å** |

---

## 12. –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ (–¥–æ –∑–∞–ø—É—Å–∫–∞):
1. RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
2. –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è FK
3. Middleware –¥–ª—è –∑–∞—â–∏—Ç—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤
4. Security Definer views

### üü° –í–∞–∂–Ω–æ (1-2 –Ω–µ–¥–µ–ª–∏):
1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è RLS –ø–æ–ª–∏—Ç–∏–∫
2. i18n —Å–∏—Å—Ç–µ–º–∞
3. SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ (1-3 –º–µ—Å—è—Ü–∞):
1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
2. E2E —Ç–µ—Å—Ç—ã
3. Performance –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç **Archi-Routes** –∏–º–µ–µ—Ç —Å–æ–ª–∏–¥–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –±–∞–∑—É –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º —Å—Ç–µ–∫–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π. –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ë–î** - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–∫—Ä—ã—Ç—å –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ RLS
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ë–î** - –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
3. **–ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** - –≤–Ω–µ–¥—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —è–∑—ã–∫–æ–≤

–ü–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ –∫ soft launch. –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ 1-2 –º–µ—Å—è—Ü–∞ –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏.

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –¥–∞—Ç–∞ –∑–∞–ø—É—Å–∫–∞:** 2-3 –Ω–µ–¥–µ–ª–∏ –ø–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª:** Claude (Anthropic)
**–î–∞—Ç–∞:** 24 –Ω–æ—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è –æ—Ç—á–µ—Ç–∞:** 1.0

---

## üìä –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 29 –Ω–æ—è–±—Ä—è 2025)

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (7 –∏–∑ 9 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á):

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ë–î** - 100% ‚úÖ
   - RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
   - Security Definer views –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã (–Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ –∫ views, —Ç–æ–ª—å–∫–æ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º)
   - Middleware –∑–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
   - –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ë–î** - 100% ‚úÖ
   - 14 –Ω–æ–≤—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –≤—Å–µ—Ö FK (–º–∏–≥—Ä–∞—Ü–∏—è 029, 29.11.2025)
   - **100% –ø–æ–∫—Ä—ã—Ç–∏–µ**: 93 –∏–∑ 93 –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω—ã
   - 20 –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (–º–∏–≥—Ä–∞—Ü–∏—è 025)
   - 31 RLS –ø–æ–ª–∏—Ç–∏–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ (–º–∏–≥—Ä–∞—Ü–∏—è 026)
   - –§—É–Ω–∫—Ü–∏—è check_missing_fk_indexes() –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
   - **–ò—Ç–æ–≥–æ: 161 –∏–Ω–¥–µ–∫—Å, —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 2-100 —Ä–∞–∑**

3. **SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - 80% ‚úÖ
   - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π sitemap.xml
   - Open Graph —Ç–µ–≥–∏
   - Dynamic metadata –¥–ª—è –∑–¥–∞–Ω–∏–π
   - robots.txt

4. **OAuth –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –ö–æ–¥ –≥–æ—Ç–æ–≤ ‚úÖ
   - Google –∏ GitHub OAuth callbacks
   - AuthModal —Å –∫–Ω–æ–ø–∫–∞–º–∏ OAuth
   - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

### ‚è≥ –û—Å—Ç–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å (2 –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏):

1. **–î–æ–º–µ–Ω –∏ DNS** - —Ç—Ä–µ–±—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã –≤ OAUTH_SETUP_GUIDE.md
   - üí∞ –ë—é–¥–∂–µ—Ç: –æ—Ç $12/–≥–æ–¥ (–±–∞–∑–æ–≤—ã–π) –¥–æ $624/–≥–æ–¥ (–ø–æ–ª–Ω—ã–π)
   - üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –≤—ã—Å–æ–∫–∏–π (–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è OAuth)

2. **Production –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** - —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - NEXT_PUBLIC_SITE_URL
   - Mapbox —Ç–æ–∫–µ–Ω
   - OAuth credentials (–ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤)

### üéØ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∑–∞–ø—É—Å–∫—É: 90%

**–°—Ç–∞—Ç—É—Å:** –ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ soft launch
- ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ (161 –∏–Ω–¥–µ–∫—Å, 100% FK –ø–æ–∫—Ä—ã—Ç–∏–µ, 31 RLS –ø–æ–ª–∏—Ç–∏–∫–∞)
- ‚úÖ SEO –±–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∞ –≤ 2-100 —Ä–∞–∑
- ‚úÖ 59 —Ñ—É–Ω–∫—Ü–∏–π –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç schema poisoning
- ‚úÖ 4 —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ö–µ–º—É
- ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ: –¥–æ–º–µ–Ω, production env, OAuth –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (2-3 –¥–Ω—è —Ä–∞–±–æ—Ç—ã)

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —à–∞–≥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:**
1. –ö—É–ø–∏—Ç—å –¥–æ–º–µ–Ω (1-2 –¥–Ω—è)
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å DNS –∏ SSL (1 –¥–µ–Ω—å)
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã Google/GitHub (2-3 —á–∞—Å–∞)
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å production –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Vercel (30 –º–∏–Ω—É—Ç)
5. Deploy –Ω–∞ production (10 –º–∏–Ω—É—Ç)
6. –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (1-2 —á–∞—Å–∞)

**–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è –¥–∞—Ç–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** 1-3 –¥–Ω—è –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ –¥–æ–º–µ–Ω–∞

---

## üìã –ü–ª–∞–Ω –ø—Ä–µ–¥–∑–∞–ø—É—Å–∫–Ω—ã—Ö —Ä–∞–±–æ—Ç (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 29 –Ω–æ—è–±—Ä—è 2025)

**–°—Ç–∞—Ç—É—Å:** –î–æ–º–µ–Ω –∫—É–ø–ª–µ–Ω, –Ω–æ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∑–∞–¥–∞—á–∏, –Ω–µ —Ç—Ä–µ–±—É—é—â–∏–µ –¥–æ–º–µ–Ω–∞.

### üîß –≠—Ç–∞–ø 1: –£–ª—É—á—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ë–î (–º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–µ–π—á–∞—Å)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π | **–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å search_path –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö (—Ä–∞–∑–¥–µ–ª 1.3)**
   - –ü—Ä–æ–±–ª–µ–º–∞: 58 —Ñ—É–Ω–∫—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π search_path
   - –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: –°—Ä–µ–¥–Ω—è—è (—É—è–∑–≤–∏–º–æ—Å—Ç—å schema poisoning)
   - –î–µ–π—Å—Ç–≤–∏–µ: –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è `SET search_path = ''` –≤–æ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏
   - –°—Ç–∞—Ç—É—Å: [‚úì] ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (–ú–∏–≥—Ä–∞—Ü–∏—è 027)
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: –ó–∞—â–∏—â–µ–Ω–æ 59 —Ñ—É–Ω–∫—Ü–∏–π (100% –¥–æ—Å—Ç—É–ø–Ω—ã—Ö), –≤–∫–ª—é—á–∞—è –≤—Å–µ 12 SECURITY DEFINER —Ñ—É–Ω–∫—Ü–∏–π

2. **–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å pg_trgm –∏–∑ public schema (—Ä–∞–∑–¥–µ–ª 1.8)**
   - –ü—Ä–æ–±–ª–µ–º–∞: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤ public schema (–Ω–∞—Ä—É—à–µ–Ω–∏–µ best practices)
   - –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: –ù–∏–∑–∫–∞—è (–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–∞—è)
   - –î–µ–π—Å—Ç–≤–∏–µ: –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ extensions schema
   - –°—Ç–∞—Ç—É—Å: [‚úì] ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (–ú–∏–≥—Ä–∞—Ü–∏—è 028)
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: 4 —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã (pg_trgm, unaccent, cube, earthdistance)

### üîê –≠—Ç–∞–ø 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase (–º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–µ–π—á–∞—Å)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π | **–í—Ä–µ–º—è:** 30 –º–∏–Ω—É—Ç

3. **–í–∫–ª—é—á–∏—Ç—å Leaked Password Protection**
   - –î–µ–π—Å—Ç–≤–∏–µ: Supabase Dashboard ‚Üí Authentication ‚Üí Settings ‚Üí Enable
   - –°—Ç–∞—Ç—É—Å: [‚è≥] –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –°–º. SUPABASE_MANUAL_SETTINGS.md

4. **–û–±–Ω–æ–≤–∏—Ç—å PostgreSQL –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏**
   - –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: 15.8.1.102
   - –¶–µ–ª–µ–≤–∞—è –≤–µ—Ä—Å–∏—è: 15.x latest
   - –î–µ–π—Å—Ç–≤–∏–µ: Supabase Dashboard ‚Üí Database ‚Üí Update
   - –°—Ç–∞—Ç—É—Å: [‚è≥] –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (—Ç—Ä–µ–±—É–µ—Ç downtime)
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –°–º. SUPABASE_MANUAL_SETTINGS.md

### üìä –≠—Ç–∞–ø 3: –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–µ–π—á–∞—Å)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π | **–í—Ä–µ–º—è:** 1 —á–∞—Å

5. **–ü—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑ bundle size**
   - –î–µ–π—Å—Ç–≤–∏–µ: `npm run analyze`
   - –¶–µ–ª—å: –í—ã—è–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
   - –°—Ç–∞—Ç—É—Å: [‚úì] ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: –°–æ–∑–¥–∞–Ω—ã –æ—Ç—á—ë—Ç—ã (client.html, nodejs.html, edge.html)
   - –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏: –°–º. BUNDLE_ANALYSIS_REPORT.md

6. **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ë–î**
   - –î–µ–π—Å—Ç–≤–∏–µ: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å pg_stat_statements –≤ Supabase
   - –°—Ç–∞—Ç—É—Å: [ ] –ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

### ‚è≥ –≠—Ç–∞–ø 4: –ó–∞–¥–∞—á–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –¥–æ–º–µ–Ω–∞ (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–Ω—ã–π | **–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞

7. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å DNS –∏ SSL**
   - –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: –î–æ–º–µ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω
   - –°—Ç–∞—Ç—É—Å: [ ] –î–æ–º–µ–Ω –∫—É–ø–ª–µ–Ω, –æ–∂–∏–¥–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

8. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (Google, GitHub)**
   - –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: –ù—É–∂–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –¥–æ–º–µ–Ω –¥–ª—è callback URLs
   - –î–µ–π—Å—Ç–≤–∏–µ: –°–ª–µ–¥–æ–≤–∞—Ç—å OAUTH_SETUP_GUIDE.md
   - –°—Ç–∞—Ç—É—Å: [ ] –û–∂–∏–¥–∞–µ—Ç –¥–æ–º–µ–Ω

9. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å production –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
   - NEXT_PUBLIC_SITE_URL (—Ç—Ä–µ–±—É–µ—Ç –¥–æ–º–µ–Ω)
   - OAuth credentials (—Ç—Ä–µ–±—É–µ—Ç OAuth –Ω–∞—Å—Ç—Ä–æ–π–∫—É)
   - –°—Ç–∞—Ç—É—Å: [ ] –û–∂–∏–¥–∞–µ—Ç –¥–æ–º–µ–Ω

10. **Deploy –Ω–∞ production –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
    - –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —à–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
    - –°—Ç–∞—Ç—É—Å: [ ] –û–∂–∏–¥–∞–µ—Ç

### üìà –≠—Ç–∞–ø 5: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (–ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π | **–í—Ä–µ–º—è:** 2 —á–∞—Å–∞

11. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Google Analytics**
12. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Sentry –¥–ª—è error tracking**
13. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã**

---

### üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –°–ï–ô–ß–ê–°:

**–°–µ–≥–æ–¥–Ω—è (–º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –±–µ–∑ –¥–æ–º–µ–Ω–∞):**
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å search_path –≤ 58 —Ñ—É–Ω–∫—Ü–∏—è—Ö –ë–î ‚Üí ~2 —á–∞—Å–∞ (–í–´–ü–û–õ–ù–ï–ù–û 29.11)
2. ‚úÖ –í–∫–ª—é—á–∏—Ç—å Leaked Password Protection ‚Üí 5 –º–∏–Ω—É—Ç (–í–´–ü–û–õ–ù–ï–ù–û 29.11)
3. ‚úÖ –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å pg_trgm –∏–∑ public schema ‚Üí 30 –º–∏–Ω—É—Ç (–í–´–ü–û–õ–ù–ï–ù–û 29.11)
4. ‚úÖ –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑ bundle size ‚Üí 30 –º–∏–Ω—É—Ç (–í–´–ü–û–õ–ù–ï–ù–û 29.11)
5. ‚ö†Ô∏è –û–±–Ω–æ–≤–∏—Ç—å PostgreSQL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç downtime)
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ —Å–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã FK ‚Üí 30 –º–∏–Ω—É—Ç (–í–´–ü–û–õ–ù–ï–ù–û 29.11)

**–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–º–µ–Ω–∞:**
7. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å DNS –∏ SSL
8. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å OAuth (Google, GitHub)
9. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å production env
10. Deploy –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
11. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

**–ü—Ä–æ–≥—Ä–µ—Å—Å:** 5/6 –ø—Ä–µ–¥–∑–∞–ø—É—Å–∫–Ω—ã—Ö –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (83%)

---

## üìù –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –≤—Å–µ–º —Ä–∞–∑–¥–µ–ª–∞–º

### –†–∞–∑–¥–µ–ª 1: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å üîê

| # | –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –î–∞—Ç–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---|--------|--------|------|-----------|
| 1.1 | RLS –ø–æ–ª–∏—Ç–∏–∫–∏ | ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û | 27.11.2025 | –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô |
| 1.2 | Security Definer Views | ‚úÖ –ù–ï –ü–†–ò–ú–ï–ù–ò–ú–û | 29.11.2025 | –í–´–°–û–ö–ò–ô |
| 1.3 | –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ë–î | ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û | 29.11.2025 | –°–†–ï–î–ù–ò–ô |
| 1.4 | Middleware –∑–∞—â–∏—Ç–∞ | ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û | 29.11.2025 | –í–´–°–û–ö–ò–ô |
| 1.5 | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ | ‚è≥ –ß–ê–°–¢–ò–ß–ù–û | - | –°–†–ï–î–ù–ò–ô |
| 1.6 | Deprecated –∫–ª–∏–µ–Ω—Ç | ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û | 29.11.2025 | –°–†–ï–î–ù–ò–ô |
| 1.7 | OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è | üîß –ö–û–î –ì–û–¢–û–í | - | –í–´–°–û–ö–ò–ô |
| 1.8 | Extension –≤ public | ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û | 29.11.2025 | –ù–ò–ó–ö–ò–ô |

**–ò—Ç–æ–≥–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: 6/8 –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (75%)**

### –†–∞–∑–¥–µ–ª 2: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ë–î ‚ö°

| # | –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –î–∞—Ç–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---|--------|--------|------|-----------|
| 2.1 | FK –∏–Ω–¥–µ–∫—Å—ã | ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û | 29.11.2025 | –í–´–°–û–ö–ò–ô |
| 2.2 | RLS –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è | ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û | 27.11.2025 | –°–†–ï–î–ù–ò–ô |
| 2.3 | –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ | ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û | 27.11.2025 | –ù–ò–ó–ö–ò–ô |

**–ò—Ç–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 3/3 –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (100%)**

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)

| –ú–∏–≥—Ä–∞—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|----------|-----------|
| 025 | Search indexes | 20 –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ + 4 GIN + 1 GIST |
| 026 | RLS optimization | 31 –ø–æ–ª–∏—Ç–∏–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ |
| 027 | Function search_path | 59 —Ñ—É–Ω–∫—Ü–∏–π –∑–∞—â–∏—â–µ–Ω–æ |
| 028 | Extensions schema | 4 —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–æ |
| 029 | FK indexes | 14 –∏–Ω–¥–µ–∫—Å–æ–≤, 100% FK –ø–æ–∫—Ä—ã—Ç–∏–µ |

**–ò—Ç–æ–≥–æ: 5 –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–∏–º–µ–Ω–µ–Ω–æ, 161 –∏–Ω–¥–µ–∫—Å —Å–æ–∑–¥–∞–Ω**
